{"title":"文件上传随记","slug":"file_upload","date":"2018-04-02T02:01:30.000Z","updated":"2018-04-25T03:14:42.179Z","comments":true,"path":"api/articles/file_upload.json","photos":[],"link":"","excerpt":null,"covers":null,"content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><blockquote>\n<p>多文件上传</p>\n</blockquote>\n<p>项目之前采用的是element-ui官方的文件上传组件，但在实际开发的过程中，发现该组件虽然能够选择多个文件进行上传，但是却不能同时上传(文件只能发送一次http请求，上传一次)。<br>最后采用 POST FormData的方式进行上传。</p>\n<h2 id=\"Fetch-FormData\"><a href=\"#Fetch-FormData\" class=\"headerlink\" title=\"Fetch FormData\"></a>Fetch FormData</h2><p>首先获取文件对象的数组(多文件的情况下，单文件就不需要遍历添加了),<br>随后实例FormData对象，将文件对象数组添加到FormData对象中，<br>再以fetch body属性上传就行了</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> fileData = <span class=\"keyword\">new</span> FormData();</span><br><span class=\"line\">filesArray.map(<span class=\"function\"><span class=\"params\">item</span>=&gt;</span>&#123;</span><br><span class=\"line\">    fileData.append(<span class=\"string\">'file'</span>,item.raw)</span><br><span class=\"line\">&#125;)        </span><br><span class=\"line\"><span class=\"keyword\">let</span> fetchOptionsForFile=&#123;</span><br><span class=\"line\">    method:<span class=\"string\">\"POST\"</span>,</span><br><span class=\"line\">    body:fileData</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">fetch(<span class=\"string\">`<span class=\"subst\">$&#123;ipConfig&#125;</span>/api/Function/MFileImport`</span>,fetchOptionsForFile).then(<span class=\"function\"><span class=\"params\">response</span>=&gt;</span>response.json()).then(<span class=\"function\"><span class=\"params\">json</span>=&gt;</span>&#123;<span class=\"built_in\">console</span>.log(json);&#125;)</span><br></pre></td></tr></table></figure>\n<h2 id=\"文件列表上传\"><a href=\"#文件列表上传\" class=\"headerlink\" title=\"文件列表上传\"></a>文件列表上传</h2><p>通过选择文件夹，取得文件夹内的文件列表然后以POST FormData的方式进行上传。</p>\n<p>上传配置只需在<code>input type=file</code>加上<code>webkitdirectory</code>属性即可。<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"fileList\"</span>  <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">webkitdirectory</span> <span class=\"attr\">v-on:change</span> =<span class=\"string\">\"uploadFileList\"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p><code>注:webkitdirectory属性目前仅支持webkit内核的浏览器。</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> fileList = <span class=\"keyword\">this</span>.$refs.fileList.files</span><br></pre></td></tr></table></figure>\n<p>取得文件列表<code>fileList</code>后循环添加到<code>fileData</code>对象就行了。</p>\n<h2 id=\"End\"><a href=\"#End\" class=\"headerlink\" title=\"End\"></a>End</h2><p>后面再补充吧。</p>\n","categories":[{"name":"前端","slug":"前端","count":5,"path":"api/categories/前端.json"}],"tags":[{"name":"fetch","slug":"fetch","count":1,"path":"api/tags/fetch.json"},{"name":"前端","slug":"前端","count":1,"path":"api/tags/前端.json"}]}