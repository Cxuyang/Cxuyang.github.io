{"name":"fetch","slug":"fetch","count":2,"postlist":[{"title":"Fetch随记","slug":"fetch","date":"2018-03-05T01:01:30.000Z","updated":"2018-03-05T03:40:35.833Z","comments":true,"path":"api/articles/fetch.json","excerpt":"","keywords":null,"cover":"/img/fetch-noheader.jpg","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><blockquote>\n<p>Fetch随记</p>\n</blockquote>\n<p>最近公司着手vue来开启新项目，前后端数据交互采用<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API\" target=\"_blank\" rel=\"noopener\">Fetch</a>。<br>虽然自己在个人的React项目中用过<code>fetch</code>框架,但当时后台数据api是支持<code>cors</code>的,当时也没想那么多。到后面实际运用配置跨域时,发现问题还是很多的。<br>在网上看到了很多很好的答案，自己总结一下。</p>\n<h2 id=\"服务器支持-CORS\"><a href=\"#服务器支持-CORS\" class=\"headerlink\" title=\"服务器支持 CORS\"></a>服务器支持 CORS</h2><p>服务器支持 CORS的情况下，可以使用Fetch Api。 </p>\n<h3 id=\"配置header\"><a href=\"#配置header\" class=\"headerlink\" title=\"配置header\"></a>配置header</h3><p>在客户端设置相应的  <code>Access-Control-Allow-Origin</code>  即可得到数据。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">let</span> myHeaders = new Headers(&#123;</span><br><span class=\"line\">    <span class=\"string\">'Access-Control-Allow-Origin'</span>: <span class=\"string\">'*'</span>,</span><br><span class=\"line\">    <span class=\"string\">'Content-Type'</span>: <span class=\"string\">'text/plain'</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">fetch(url, &#123;</span><br><span class=\"line\">    method: <span class=\"string\">'GET'</span>,</span><br><span class=\"line\">    headers: myHeaders,</span><br><span class=\"line\">    mode: <span class=\"string\">'cors'</span></span><br><span class=\"line\">&#125;) .<span class=\"keyword\">then</span>((res) =&gt; &#123;</span><br><span class=\"line\">    // TODO </span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">作者：Seven</span><br><span class=\"line\">链接：https://www.zhihu.com/question/47029864/answer/150069385</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"不配置header\"><a href=\"#不配置header\" class=\"headerlink\" title=\"不配置header\"></a>不配置header</h3><p>不配置header的话有可能返回的是一个response对象,<br><img src=\"/img/fetch-noheader.jpg\" alt=\"fetch-noheader\"><br>这时可将<code>.(response=&gt;response.json())</code>改为<code>.(response=&gt;response.text())</code>;</p>\n<h2 id=\"服务器不支持-CORS\"><a href=\"#服务器不支持-CORS\" class=\"headerlink\" title=\"服务器不支持 CORS\"></a>服务器不支持 CORS</h2><h3 id=\"联系后端人员修改\"><a href=\"#联系后端人员修改\" class=\"headerlink\" title=\"联系后端人员修改\"></a>联系后端人员修改</h3><h3 id=\"采用JSONP方式\"><a href=\"#采用JSONP方式\" class=\"headerlink\" title=\"采用JSONP方式\"></a>采用JSONP方式</h3><p>我看到知乎上有一篇介绍JSONP很好的文章，我就不展开说了<br><a href=\"https://zhuanlan.zhihu.com/p/22338759\" target=\"_blank\" rel=\"noopener\">JSONP</a></p>\n<h2 id=\"End\"><a href=\"#End\" class=\"headerlink\" title=\"End\"></a>End</h2>","text":"前言Fetch随记最近公司着手vue来开启新项目，前后端数据交互采用Fetch。<br>虽然自己在个人的React项目中用过fetch框架,但当时后台数据api是支持cors的,当时也没想那么多。到后面实际运用配置跨域时,发现问题还是很多的。<br>在网上看到了很多很好的答案，自","link":"","raw":null,"photos":[],"categories":[{"name":"ES6","slug":"ES6","count":2,"path":"api/categories/ES6.json"}],"tags":[{"name":"fetch","slug":"fetch","count":2,"path":"api/tags/fetch.json"},{"name":"前端","slug":"前端","count":2,"path":"api/tags/前端.json"}]},{"title":"fetch文件上传","slug":"fetch_file_upload","date":"2018-04-02T02:01:30.000Z","updated":"2018-04-16T02:22:46.809Z","comments":true,"path":"api/articles/fetch_file_upload.json","excerpt":"","keywords":null,"cover":null,"content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><blockquote>\n<p>fetch多文件上传</p>\n</blockquote>\n<p>项目之前采用的是element-ui官方的文件上传组件，但在实际开发的过程中，发现该组件虽然能够选择多个文件进行上传，但是却不能同时上传(文件只能发送一次http请求，上传一次)。<br>后来上网查询，发现了Fetch FormData的方式比较可行。</p>\n<h2 id=\"Fetch-FormData\"><a href=\"#Fetch-FormData\" class=\"headerlink\" title=\"Fetch FormData\"></a>Fetch FormData</h2><p>首先获取文件对象的数组(多文件的情况下，单文件就不需要遍历添加了),<br>随后实例FormData对象，将文件对象数组添加到FormData对象中，<br>再以fetch body属性上传就行了</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">let</span> fileData = new FormData();</span><br><span class=\"line\">filesArray.map(item=&gt;&#123;</span><br><span class=\"line\">    fileData.append(<span class=\"string\">'file'</span>,item.raw)</span><br><span class=\"line\">&#125;)        </span><br><span class=\"line\"><span class=\"built_in\">let</span> fetchOptionsForFile=&#123;</span><br><span class=\"line\">    method:<span class=\"string\">\"POST\"</span>,</span><br><span class=\"line\">    body:fileData</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">fetch(`<span class=\"variable\">$&#123;ipConfig&#125;</span>/api/Function/MFileImport`,fetchOptionsForFile).<span class=\"keyword\">then</span>(response=&gt;response.json()).<span class=\"keyword\">then</span>(json=&gt;&#123;console.log(json);&#125;)</span><br></pre></td></tr></table></figure>\n<h2 id=\"End\"><a href=\"#End\" class=\"headerlink\" title=\"End\"></a>End</h2><p>后面再补充吧。</p>\n","text":"前言fetch多文件上传项目之前采用的是element-ui官方的文件上传组件，但在实际开发的过程中，发现该组件虽然能够选择多个文件进行上传，但是却不能同时上传(文件只能发送一次http请求，上传一次)。<br>后来上网查询，发现了Fetch FormData的方式比较可行。Fe","link":"","raw":null,"photos":[],"categories":[{"name":"前端","slug":"前端","count":1,"path":"api/categories/前端.json"}],"tags":[{"name":"fetch","slug":"fetch","count":2,"path":"api/tags/fetch.json"},{"name":"前端","slug":"前端","count":2,"path":"api/tags/前端.json"}]}]}