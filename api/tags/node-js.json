{"name":"Node.js","slug":"Node-js","count":1,"postlist":[{"title":"linuxéƒ¨ç½²ä¸nginxä»£ç†","slug":"linuxéƒ¨ç½²ä¸nginxä»£ç†","date":"2018-07-05T01:01:30.000Z","updated":"2018-07-09T02:30:14.177Z","comments":true,"path":"api/articles/linuxéƒ¨ç½²ä¸nginxä»£ç†.json","excerpt":"","keywords":null,"cover":null,"content":"<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>æ€»ç»“ä¸€ä¸‹è‡ªå·±åœ¨linux(<code>ä»¥ä¸‹ä»¥centos7.2ä¸ºä¾‹</code>)ä¸‹éƒ¨ç½²ç½‘ç«™æ‰€é‡åˆ°çš„é—®é¢˜ä»¥åŠæ„Ÿæƒ³ã€‚<code>(linuxç³»ç»Ÿã€nginxåŸºæœ¬çŸ¥è¯†å°±ä¸å±•å¼€è®²äº†)</code></p>\n<h3 id=\"é™æ€ç½‘ç«™éƒ¨ç½²\"><a href=\"#é™æ€ç½‘ç«™éƒ¨ç½²\" class=\"headerlink\" title=\"é™æ€ç½‘ç«™éƒ¨ç½²\"></a>é™æ€ç½‘ç«™éƒ¨ç½²</h3><ol>\n<li>å®‰è£…å¥½linuxç³»ç»Ÿä»¥åŠ<code>vim</code>ã€<code>nginx</code>ç­‰ç­‰å¸¸ç”¨è½¯ä»¶</li>\n<li>è¿›å…¥ <code>/etc/nginx/conf.d</code> ç›®å½•ï¼Œä¸€èˆ¬ä¼šæœ‰ä¸ª<code>default.conf</code>é…ç½®æ–‡ä»¶ã€‚ä»¥ä½ çš„å·¥ç¨‹åæ–°å»ºä¸€ä¸ª<code>.confæ–‡ä»¶</code>,å†…å®¹åŒ<code>default.conf</code>ç›¸åŒã€‚</li>\n<li>é…ç½®<code>.conf</code>æ–‡ä»¶(è¯¦æƒ…é…ç½®è¯´æ˜è§<a href=\"https://blog.csdn.net/u010320371/article/details/78995097\" target=\"_blank\" rel=\"noopener\">.conf</a>)</li>\n<li>location é…ç½®(ä»¥<code>sell</code>å·¥ç¨‹ä¸ºä¾‹)<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">location /sell/ &#123;</span><br><span class=\"line\">  rewrite ^/server_name/sell/index.html  //server_nameä¸ºä½ çš„IPæˆ–è€…åŸŸå</span><br><span class=\"line\">  root   /data/www;  //é¡¹ç›®è·¯å¾„ä½ç½®</span><br><span class=\"line\">  index  index.html index.htm;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"nginxæœåŠ¡ä»£ç†\"><a href=\"#nginxæœåŠ¡ä»£ç†\" class=\"headerlink\" title=\"nginxæœåŠ¡ä»£ç†\"></a>nginxæœåŠ¡ä»£ç†</h3><blockquote>\n<p>ä»¥æˆ‘ä¹‹å‰çš„çƒçƒéŸ³ä¹ä¸ºä¾‹</p>\n</blockquote>\n<ol>\n<li>å®‰è£…node.jsã€pm2</li>\n<li>ä¿®æ”¹ä½ å‰å°è¯·æ±‚nodeåœ°å€ä¸ºæœåŠ¡å™¨çš„IPæˆ–è€…åŸŸå</li>\n<li>åé¢æ­¥éª¤ä¸é™æ€éƒ¨ç½²ç›¸åŒ</li>\n<li>pm2å¯åŠ¨expressæ–‡ä»¶</li>\n<li>locationé…ç½®<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">location /qqmusic/ &#123;</span><br><span class=\"line\">  rewrite ^/server_name/qqmusic/index.html  //server_nameä¸ºä½ çš„IPæˆ–è€…åŸŸå</span><br><span class=\"line\">  proxy_set_header X-RealIP $remote_addr;</span><br><span class=\"line\">  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">  proxy_set_header Host $http_host;</span><br><span class=\"line\">  proxy_set_header X-Nginx-Proxy true;</span><br><span class=\"line\">  proxy_pass http://127.0.0.1:4000/; // è¿™é‡Œçš„ç«¯å£è¦å’Œä½ çš„nodeæœåŠ¡ç«¯å£ç›¸åŒ</span><br><span class=\"line\">  root   /data/www;  //é¡¹ç›®è·¯å¾„ä½ç½®</span><br><span class=\"line\">  index  index.html index.htm;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"ä»¥åå†è¡¥å……\"><a href=\"#ä»¥åå†è¡¥å……\" class=\"headerlink\" title=\"ä»¥åå†è¡¥å……\"></a>ä»¥åå†è¡¥å……</h3><h2 id=\"End\"><a href=\"#End\" class=\"headerlink\" title=\"End\"></a>End</h2>","text":"å‰è¨€æ€»ç»“ä¸€ä¸‹è‡ªå·±åœ¨linux(ä»¥ä¸‹ä»¥centos7.2ä¸ºä¾‹)ä¸‹éƒ¨ç½²ç½‘ç«™æ‰€é‡åˆ°çš„é—®é¢˜ä»¥åŠæ„Ÿæƒ³ã€‚(linuxç³»ç»Ÿã€nginxåŸºæœ¬çŸ¥è¯†å°±ä¸å±•å¼€è®²äº†)é™æ€ç½‘ç«™éƒ¨ç½²å®‰è£…å¥½linuxç³»ç»Ÿä»¥åŠvimã€nginxç­‰ç­‰å¸¸ç”¨è½¯ä»¶è¿›å…¥ /etc/nginx/conf.d ç›®å½•ï¼Œä¸€èˆ¬ä¼šæœ‰ä¸ªdefault","link":"","raw":null,"photos":[],"categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","count":5,"path":"api/categories/å‰ç«¯.json"}],"tags":[{"name":"Node.js","slug":"Node-js","count":1,"path":"api/tags/Node-js.json"},{"name":"Linux","slug":"Linux","count":1,"path":"api/tags/Linux.json"},{"name":"Nginx","slug":"Nginx","count":1,"path":"api/tags/Nginx.json"}]}]}¨expressé…ç½®æ–‡ä»¶ä¸‹é…ç½®ç›¸åº”è·¯ç”±å°±è¡Œäº†</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//é¦–å…ˆå¼•å…¥axiosä»¥åŠbodyParser</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> axios = <span class=\"built_in\">require</span>(<span class=\"string\">'axios'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> bodyParser = <span class=\"built_in\">require</span>(<span class=\"string\">'body-parser'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> devWebpackConfig = merge(baseWebpackConfig, &#123;</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: utils.styleLoaders(&#123;<span class=\"attr\">sourceMap</span>: config.dev.cssSourceMap, <span class=\"attr\">usePostCSS</span>: <span class=\"literal\">true</span>&#125;)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// cheap-module-eval-source-map is faster for development</span></span><br><span class=\"line\">  devtool: config.dev.devtool,</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// these devServer options should be customized in /config/index.js</span></span><br><span class=\"line\">  devServer: &#123;</span><br><span class=\"line\">    before(app) &#123;</span><br><span class=\"line\">\t  <span class=\"comment\">//bodyParser.urlencodedæ¥æ”¶req.body,å¹¶å¯¹å…¶è¿›è¡Œè§£æã€‚</span></span><br><span class=\"line\">      app.use(bodyParser.urlencoded(&#123;<span class=\"attr\">extended</span>: <span class=\"literal\">true</span>&#125;))</span><br><span class=\"line\">      app.get(<span class=\"string\">'/api/getDiscList'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> url = <span class=\"string\">'https://c.y.qq.com/splcloud/fcgi-bin/fcg_get_diss_by_tag.fcg'</span></span><br><span class=\"line\">        axios.get(url, &#123;</span><br><span class=\"line\">          headers: &#123;</span><br><span class=\"line\">            referer: <span class=\"string\">'https://c.y.qq.com/'</span>,</span><br><span class=\"line\">            host: <span class=\"string\">'c.y.qq.com'</span></span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          params: req.query</span><br><span class=\"line\">        &#125;).then(<span class=\"function\">(<span class=\"params\">response</span>) =&gt;</span> &#123;</span><br><span class=\"line\">          res.json(response.data)</span><br><span class=\"line\">        &#125;).catch(<span class=\"function\">(<span class=\"params\">e</span>) =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(e)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">//...</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>api/getDiscList.js</code><br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getDiscList</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> url = <span class=\"string\">'/api/getDiscList'</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> data = <span class=\"built_in\">Object</span>.assign(&#123;&#125;, commonParams, &#123;</span><br><span class=\"line\">    platform: <span class=\"string\">'yqq'</span>,</span><br><span class=\"line\">    hostUin: <span class=\"number\">0</span>,</span><br><span class=\"line\">    sin: <span class=\"number\">0</span>,</span><br><span class=\"line\">    ein: <span class=\"number\">29</span>,</span><br><span class=\"line\">    sortId: <span class=\"number\">5</span>,</span><br><span class=\"line\">    needNewCode: <span class=\"number\">0</span>,</span><br><span class=\"line\">    categoryId: <span class=\"number\">10000000</span>,</span><br><span class=\"line\">    rnd: <span class=\"built_in\">Math</span>.random(),</span><br><span class=\"line\">    format: <span class=\"string\">'json'</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> axios.get(url, &#123;</span><br><span class=\"line\">    params: data</span><br><span class=\"line\">  &#125;).then(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.resolve(res.data)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>å®ç°åŸç†:1.è°ƒç”¨<code>getDiscList</code>æ–¹æ³•ã€‚2.è¯·æ±‚<code>Express</code>ä»£ç†æœåŠ¡é…ç½®åœ°å€ã€‚3.é€šè¿‡å›è°ƒå‡½æ•°è¿”å›æ•°æ®ã€‚</p>\n<p>ä»¥ä¸Šæœ‰é”™è¯¯çš„åœ°æ–¹,æˆ–è€…ä¸æ‡‚çš„åœ°æ–¹,æ¬¢è¿æ¥æˆ‘çš„å¾®åšç»™æˆ‘ç•™è¨€ã€‚</p>\n<h2 id=\"End\"><a href=\"#End\" class=\"headerlink\" title=\"End\"></a>End</h2>","text":"å‰è¨€æœ€è¿‘åšè‡ªå·±ä¸ªäººé¡¹ç›®(çƒçƒéŸ³ä¹PCç«¯ä»¥åŠç§»åŠ¨ç«¯)çš„æ—¶å€™ï¼Œæ¶‰åŠåˆ°æ¥å£æ•°æ®çš„æŠ“å–ã€‚<br>æ ¹æ®æ¥å£çš„ç‰¹æ€§,ç”¨åˆ°äº†jsonpçš„æ–¹å¼è¿›è¡ŒæŠ“å–ï¼Œè°ˆè°ˆè‡ªå·±çš„æ€»ç»“å§ã€‚JSONPå·¥ä½œåŸç†è¿›è¡Œjsonpé€šä¿¡æ—¶,å®¢æˆ·ç«¯ä¼šåœ¨å…¶è„šæœ¬ä¸Šæ–°å»ºä¸€ä¸ª&lt;script&gt;å…ƒç´ ,å…¶srcåœ°å€æŒ‡å‘APIæ¥å£","link":"","raw":null,"photos":[],"categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","count":5,"path":"api/categories/å‰ç«¯.json"}],"tags":[{"name":"axios","slug":"axios","count":1,"path":"api/tags/axios.json"},{"name":"jsonp","slug":"jsonp","count":1,"path":"api/tags/jsonp.json"},{"name":"node.js","slug":"node-js","count":1,"path":"api/tags/node-js.json"}]}]}